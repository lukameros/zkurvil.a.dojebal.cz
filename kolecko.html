<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üé∞ Kolo ≈°tƒõst√≠ - Mince üé∞</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Bangers&display=swap');

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Bangers', cursive;
    background: linear-gradient(135deg, #1a0033 0%, #330066 50%, #1a0033 100%);
    overflow-x: hidden;
    position: relative;
    min-height: 100vh;
}

body.theme-ocean { background: linear-gradient(135deg, #001a33 0%, #003366 50%, #001a33 100%); }
body.theme-fire { background: linear-gradient(135deg, #330000 0%, #660000 50%, #330000 100%); }
body.theme-forest { background: linear-gradient(135deg, #003300 0%, #006600 50%, #003300 100%); }
body.theme-gold { background: linear-gradient(135deg, #332200 0%, #664400 50%, #332200 100%); }
body.theme-pink { background: linear-gradient(135deg, #330022 0%, #660044 50%, #330022 100%); }
body.theme-neon { background: linear-gradient(135deg, #000033 0%, #330066 50%, #000033 100%); }
body.theme-sunset { background: linear-gradient(135deg, #331100 0%, #663300 50%, #331100 100%); }
body.theme-ice { background: linear-gradient(135deg, #002233 0%, #004466 50%, #002233 100%); }
body.theme-galaxy { background: linear-gradient(135deg, #110033 0%, #220066 50%, #110033 100%); }
body.theme-rainbow {
    background: linear-gradient(135deg, #ff0080 0%, #8000ff 25%, #0080ff 50%, #00ff80 75%, #ff0080 100%);
    background-size: 400% 400%;
    animation: rainbowShift 10s ease infinite;
}

@keyframes rainbowShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

body::before {
    content: "";
    position: fixed;
    inset: 0;
    background: 
        radial-gradient(circle at 20% 50%, rgba(255,0,150,0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(0,150,255,0.3) 0%, transparent 50%);
    animation: bgPulse 4s ease-in-out infinite;
    z-index: 0;
}

@keyframes bgPulse {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

.star {
    position: fixed;
    width: 2px;
    height: 2px;
    background: white;
    border-radius: 50%;
    animation: twinkle 3s infinite;
    z-index: 1;
}

@keyframes twinkle {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 1; }
}

#wrapper {
    position: relative;
    width: 100%;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 20;
    padding: 20px;
}

#topBar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 70px;
    background: rgba(26,0,51,0.95);
    border-bottom: 3px solid #ff00ff;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    z-index: 100;
    box-shadow: 0 5px 20px rgba(255,0,255,0.5);
}

.admin-badge {
    position: fixed;
    top: 10px;
    right: 50%;
    transform: translateX(50%);
    background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
    color: #fff;
    padding: 8px 20px;
    border-radius: 20px;
    border: 3px solid #ff0000;
    font-size: 18px;
    font-weight: bold;
    z-index: 150;
    box-shadow: 0 0 30px rgba(255,0,0,0.8);
    animation: adminPulse 2s ease-in-out infinite;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}

@keyframes adminPulse {
    0%, 100% { box-shadow: 0 0 30px rgba(255,0,0,0.8); }
    50% { box-shadow: 0 0 50px rgba(255,0,0,1); transform: translateX(50%) scale(1.05); }
}

#backBtn {
    padding: 10px 20px;
    border: 3px solid #ff00ff;
    background: linear-gradient(135deg, #1a0033 0%, #330066 100%);
    color: #fff;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 0 20px #ff00ff;
    transition: all 0.3s ease;
    border-radius: 10px;
}

#backBtn:hover {
    background: linear-gradient(135deg, #ff00ff 0%, #00ffff 100%);
    color: #000;
    transform: scale(1.05);
}

#userInfo {
    display: flex;
    align-items: center;
    gap: 20px;
}

#userName {
    color: #ffff00;
    font-size: 24px;
    text-shadow: 0 0 10px #ff00ff;
}

#coinDisplay {
    display: flex;
    align-items: center;
    gap: 10px;
    background: linear-gradient(135deg, #ffaa00 0%, #ff6600 100%);
    padding: 8px 20px;
    border-radius: 20px;
    border: 3px solid #ffff00;
    box-shadow: 0 0 20px rgba(255,200,0,0.8);
    animation: coinGlow 2s ease-in-out infinite;
}

@keyframes coinGlow {
    0%, 100% { box-shadow: 0 0 20px rgba(255,200,0,0.8); }
    50% { box-shadow: 0 0 40px rgba(255,200,0,1); }
}

#coinAmount {
    color: #000;
    font-size: 28px;
    font-weight: bold;
    text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
}

#shopBtn, #adminBtn {
    padding: 10px 25px;
    border: 3px solid #00ffff;
    background: linear-gradient(135deg, #00ffff 0%, #0080ff 100%);
    color: #000;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,255,255,0.6);
    transition: all 0.3s ease;
}

#shopBtn:hover, #adminBtn:hover {
    transform: scale(1.1);
    box-shadow: 0 0 40px rgba(0,255,255,1);
}

#adminBtn {
    border-color: #ff0000;
    background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
    color: #fff;
    box-shadow: 0 0 20px rgba(255,0,0,0.6);
    display: none;
}

#adminBtn:hover {
    box-shadow: 0 0 40px rgba(255,0,0,1);
}

#wheelContainer {
    position: relative;
    margin-top: 80px;
    filter: drop-shadow(0 0 50px rgba(255,0,255,0.8));
}

.pointer {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -280px);
    width: 0;
    height: 0;
    border-left: 25px solid transparent;
    border-right: 25px solid transparent;
    border-top: 50px solid #ffff00;
    filter: drop-shadow(0 0 20px #ffff00);
    z-index: 50;
    animation: pointerBounce 0.8s ease-in-out infinite;
}

@keyframes pointerBounce {
    0%, 100% { transform: translate(-50%, -280px); }
    50% { transform: translate(-50%, -290px); }
}

canvas {
    max-width: 500px;
    max-height: 500px;
    border-radius: 50%;
    border: 5px solid #ffff00;
    box-shadow: 0 0 60px #ff00ff, 0 0 100px #00ffff;
}

.wheelCenter {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #ff00ff 0%, #00ffff 100%);
    border-radius: 50%;
    border: 4px solid #ffff00;
    box-shadow: 0 0 30px #ffff00;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 30px;
    z-index: 60;
}

#wheelTitle {
    color: #ffff00;
    font-size: 36px;
    margin: 20px 0;
    text-align: center;
    text-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff;
}

#spinBtn {
    margin-top: 30px;
    padding: 20px 60px;
    border-radius: 25px;
    font-weight: bold;
    font-size: 32px;
    cursor: pointer;
    font-family: 'Bangers', cursive;
    background: linear-gradient(135deg, #ffff00 0%, #ff8800 100%);
    color: #000;
    border: 4px solid #ffff00;
    box-shadow: 0 0 30px rgba(255,255,0,0.8);
    transition: all 0.3s ease;
    animation: spinPulse 1.5s ease-in-out infinite;
}

@keyframes spinPulse {
    0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(255,255,0,0.8); }
    50% { transform: scale(1.05); box-shadow: 0 0 50px rgba(255,255,0,1); }
}

#spinBtn:hover {
    transform: scale(1.1) rotate(-3deg);
}

#spinBtn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    animation: none;
}

#leaderboard {
    position: fixed;
    top: 90px;
    right: 20px;
    width: 300px;
    max-height: 500px;
    background: linear-gradient(135deg, rgba(26,0,51,0.95) 0%, rgba(51,0,102,0.95) 100%);
    border: 3px solid #ff00ff;
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 0 40px rgba(255,0,255,0.8);
    z-index: 90;
    overflow-y: auto;
}

#leaderboard h3 {
    color: #ffff00;
    font-size: 28px;
    text-align: center;
    margin-bottom: 15px;
    text-shadow: 0 0 10px #ff00ff;
}

.leaderboard-item {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    margin: 5px 0;
    background: rgba(255,0,255,0.1);
    border-radius: 10px;
    border: 1px solid rgba(255,0,255,0.3);
    transition: all 0.3s ease;
}

.leaderboard-item:hover {
    background: rgba(255,0,255,0.3);
    transform: translateX(-5px);
}

.leaderboard-rank {
    color: #ffff00;
    font-size: 20px;
    font-weight: bold;
    min-width: 40px;
}

.leaderboard-name {
    color: #fff;
    font-size: 18px;
    flex: 1;
}

.leaderboard-coins {
    color: #ffaa00;
    font-size: 18px;
    font-weight: bold;
}

.modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.9);
    align-items: center;
    justify-content: center;
    z-index: 200;
    backdrop-filter: blur(10px);
}

.modal-content {
    background: linear-gradient(135deg, #330066 0%, #1a0033 100%);
    padding: 40px;
    border-radius: 30px;
    border: 5px solid #ffff00;
    box-shadow: 0 0 100px #ff00ff;
    max-width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    animation: modalAppear 0.3s ease-out;
}

@keyframes modalAppear {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.modal h2 {
    color: #ffff00;
    font-size: 48px;
    text-align: center;
    margin-bottom: 30px;
    text-shadow: 0 0 20px #ff00ff;
}

.modal-close {
    margin-top: 20px;
    padding: 15px 40px;
    font-size: 24px;
    border-radius: 20px;
    border: 3px solid #00ffff;
    background: linear-gradient(135deg, #00ffff 0%, #0080ff 100%);
    color: #000;
    font-weight: bold;
    cursor: pointer;
    font-family: 'Bangers', cursive;
    transition: all 0.3s ease;
    display: block;
    margin-left: auto;
    margin-right: auto;
}

.modal-close:hover {
    transform: scale(1.1);
    box-shadow: 0 0 30px rgba(0,255,255,1);
}

#shopGrid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.shop-item {
    background: rgba(255,0,255,0.1);
    border: 3px solid #ff00ff;
    border-radius: 20px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
}

.shop-item:hover {
    transform: translateY(-10px);
    box-shadow: 0 10px 30px rgba(255,0,255,0.5);
}

.shop-item.owned {
    border-color: #00ff00;
    background: rgba(0,255,0,0.1);
}

.shop-item.active {
    border-color: #ffff00;
    background: rgba(255,255,0,0.2);
    box-shadow: 0 0 30px rgba(255,255,0,0.8);
}

.shop-preview {
    width: 100%;
    height: 100px;
    border-radius: 10px;
    margin-bottom: 15px;
}

.shop-name {
    color: #fff;
    font-size: 24px;
    margin: 10px 0;
}

.shop-price {
    color: #ffaa00;
    font-size: 20px;
    margin: 10px 0;
}

.shop-buy-btn {
    padding: 10px 30px;
    border-radius: 15px;
    border: 2px solid #00ff00;
    background: linear-gradient(135deg, #00ff00 0%, #00aa00 100%);
    color: #000;
    font-weight: bold;
    cursor: pointer;
    font-family: 'Bangers', cursive;
    font-size: 18px;
    transition: all 0.3s ease;
}

.shop-buy-btn:hover {
    transform: scale(1.1);
}

.shop-buy-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

#loginModal input {
    width: 100%;
    padding: 15px;
    margin: 10px 0;
    border-radius: 15px;
    border: 3px solid #ff00ff;
    background: rgba(26,0,51,0.8);
    color: #fff;
    font-size: 20px;
    font-family: 'Bangers', cursive;
}

#loginModal input:focus {
    outline: none;
    border-color: #00ffff;
    box-shadow: 0 0 20px rgba(0,255,255,0.5);
}

#loginModal button {
    width: 100%;
    padding: 15px;
    margin: 10px 0;
    border-radius: 15px;
    border: 3px solid #00ff00;
    background: linear-gradient(135deg, #00ff00 0%, #00aa00 100%);
    color: #000;
    font-weight: bold;
    cursor: pointer;
    font-family: 'Bangers', cursive;
    font-size: 24px;
    transition: all 0.3s ease;
}

#loginModal button:hover {
    transform: scale(1.05);
}

#winAmount {
    color: #ffaa00;
    font-size: 72px;
    margin: 20px 0;
    text-shadow: 0 0 30px #ffaa00;
    animation: winBounce 0.6s ease-in-out infinite;
}

@keyframes winBounce {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    z-index: 250;
    pointer-events: none;
    border-radius: 50%;
}

.admin-section {
    background: rgba(255,0,0,0.1);
    border: 2px solid #ff0000;
    border-radius: 15px;
    padding: 20px;
    margin: 20px 0;
}

.admin-section h3 {
    color: #ff0000;
    font-size: 24px;
    margin-bottom: 15px;
}

.admin-section button {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    background: linear-gradient(135deg, #ff6600 0%, #ff3300 100%);
    border: 2px solid #ff3300;
    border-radius: 10px;
    color: #fff;
    font-size: 18px;
    cursor: pointer;
    font-family: 'Bangers', cursive;
    transition: all 0.3s ease;
}

.admin-section button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(255,0,0,0.5);
}

.admin-section input {
    width: 100%;
    padding: 10px;
    margin: 5px 0;
    border-radius: 10px;
    border: 2px solid #ff00ff;
    background: rgba(26,0,51,0.8);
    color: #fff;
    font-size: 16px;
    font-family: 'Bangers', cursive;
}

.admin-stats {
    color: #fff;
    font-size: 18px;
    line-height: 2;
}

.admin-stats span {
    color: #ffff00;
}

@media (max-width: 768px) {
    #leaderboard {
        display: none;
    }
    
    canvas {
        max-width: 350px;
        max-height: 350px;
    }
    
    #topBar {
        flex-wrap: wrap;
        height: auto;
        padding: 10px;
    }
    
    #shopGrid {
        grid-template-columns: 1fr;
    }
}

::-webkit-scrollbar {
    width: 10px;
}

::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.3);
}

::-webkit-scrollbar-thumb {
    background: #ff00ff;
    border-radius: 5px;
}
</style>
</head>
<body>

<div id="topBar">
    <button id="backBtn" onclick="goBack()">‚¨Ö ZPƒöT</button>
    <div id="userInfo">
        <span id="userName">Hr√°ƒç</span>
        <div id="coinDisplay">
            <span>ü™ô</span>
            <span id="coinAmount">0</span>
        </div>
    </div>
    <div style="display: flex; gap: 10px;">
        <button id="shopBtn" onclick="openShop()">üõí OBCHOD</button>
        <button id="adminBtn" onclick="openAdminPanel()">‚öôÔ∏è ADMIN</button>
    </div>
</div>

<div class="admin-badge" id="adminBadge" style="display: none;">
    üî¥ ADMIN RE≈ΩIM üî¥
</div>

<div id="wrapper">
    <div id="wheelContainer">
        <div class="pointer"></div>
        <canvas id="wheel" width="500" height="500"></canvas>
        <div class="wheelCenter">üé∞</div>
    </div>
    
    <h2 id="wheelTitle">ZATOƒåTE A Z√çSKEJTE MINCE!</h2>
    
    <button id="spinBtn" onclick="spin()">üéØ ZATOƒåIT ZDARMA!</button>
</div>

<div id="leaderboard">
    <h3>üèÜ ≈ΩEB≈ò√çƒåEK üèÜ</h3>
    <div id="leaderboardList"></div>
</div>

<div id="loginModal" class="modal" style="display: flex;">
    <div class="modal-content">
        <h2>üéÆ V√çTEJTE üéÆ</h2>
        <p style="color: #fff; text-align: center; font-size: 20px; margin-bottom: 20px;">
            Zadejte sv√© hern√≠ jm√©no:
        </p>
        <input type="text" id="nicknameInput" placeholder="Va≈°e p≈ôezd√≠vka..." maxlength="15">
        <button onclick="login()">HR√ÅT!</button>
    </div>
</div>

<div id="winModal" class="modal">
    <div class="modal-content">
        <h2>üéâ V√ùHRA üéâ</h2>
        <div id="winAmount">+100 ü™ô</div>
        <button class="modal-close" onclick="closeWinModal()">SUPER!</button>
    </div>
</div>

<div id="shopModal" class="modal">
    <div class="modal-content">
        <h2>üõí OBCHOD SE VZHLEDEM üõí</h2>
        <div id="shopGrid"></div>
        <button class="modal-close" onclick="closeShop()">ZAV≈ò√çT</button>
    </div>
</div>

<div id="adminPanel" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <h2>‚öôÔ∏è ADMIN PANEL ‚öôÔ∏è</h2>
        
        <div class="admin-section">
            <h3>üìä STATISTIKY</h3>
            <div class="admin-stats">
                <div>üë• Celkem hr√°ƒç≈Ø v ≈æeb≈ô√≠ƒçku: <span id="totalPlayers">0</span></div>
                <div>üèÜ Nejv√≠ce minc√≠: <span id="topPlayer">-</span></div>
            </div>
        </div>
        
        <div class="admin-section">
            <h3>üéÆ SPR√ÅVA DAT</h3>
            <button onclick="clearLeaderboard()">üóëÔ∏è Vymazat ≈æeb≈ô√≠ƒçek</button>
            <button onclick="exportLeaderboard()">üì• Exportovat ≈æeb≈ô√≠ƒçek</button>
            <button onclick="resetMyCoins()">üîÑ Resetovat m√© mince</button>
        </div>
        
        <div class="admin-section">
            <h3>üé® ADMIN BONUS</h3>
            <button onclick="unlockAllThemes()">üîì Odemknout v≈°echny vzhled</button>
            <button onclick="addCoins(1000)">üí∞ P≈ôidat 1000 minc√≠</button>
        </div>
        
        <button class="modal-close" onclick="closeAdminPanel()">ZAV≈ò√çT</button>
    </div>
</div>

<script type="module">
// Firebase pro POUZE ≈æeb≈ô√≠ƒçek
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, set, onValue, remove } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

const firebaseConfig = {
    apiKey: "AIzaSyDOap2QsXnBvqC2WWp907fAACI0o5qIBk4",
    authDomain: "tetrisleaderboard-3b345.firebaseapp.com",
    databaseURL: "https://tetrisleaderboard-3b345-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "tetrisleaderboard-3b345",
    storageBucket: "tetrisleaderboard-3b345.firebasestorage.app",
    messagingSenderId: "1066407746580",
    appId: "1:1066407746580:web:b8de384e86711899f99b01"
};

let database;
try {
    const app = initializeApp(firebaseConfig);
    database = getDatabase(app);
    console.log('‚úÖ Firebase p≈ôipojeno');
} catch (error) {
    console.warn('‚ö†Ô∏è Firebase nedostupn√©, ≈æeb≈ô√≠ƒçek nebude fungovat:', error);
}

// Vytvo≈ôen√≠ hvƒõzd
for(let i = 0; i < 50; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    star.style.left = Math.random() * 100 + '%';
    star.style.top = Math.random() * 100 + '%';
    star.style.animationDelay = Math.random() * 3 + 's';
    document.body.appendChild(star);
}

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const center = canvas.width / 2;

// Lok√°ln√≠ data hr√°ƒçe (localStorage)
let currentUser = {
    id: null,
    nickname: '',
    coins: 0,
    ownedThemes: ['default'],
    activeTheme: 'default'
};

let isAdmin = false;
const ADMIN_PASSWORD = 'lukas89';

const wheelPrizes = [
    { coins: 50, color: '#ff0080', weight: 30 },
    { coins: 100, color: '#00ff80', weight: 25 },
    { coins: 150, color: '#0080ff', weight: 20 },
    { coins: 200, color: '#ff8000', weight: 15 },
    { coins: 0, color: '#666666', weight: 9.9 },
    { coins: 1000, color: '#ffff00', weight: 0.1 }
];

const themes = [
    { id: 'default', name: 'Z√°kladn√≠', price: 0, gradient: 'linear-gradient(135deg, #1a0033 0%, #330066 50%, #1a0033 100%)' },
    { id: 'ocean', name: 'Oce√°n', price: 500, gradient: 'linear-gradient(135deg, #001a33 0%, #003366 50%, #001a33 100%)' },
    { id: 'fire', name: 'Ohe≈à', price: 500, gradient: 'linear-gradient(135deg, #330000 0%, #660000 50%, #330000 100%)' },
    { id: 'forest', name: 'Les', price: 750, gradient: 'linear-gradient(135deg, #003300 0%, #006600 50%, #003300 100%)' },
    { id: 'gold', name: 'Zlato', price: 1000, gradient: 'linear-gradient(135deg, #332200 0
    { id: 'pink', name: 'R≈Ø≈æov√°', price: 750, gradient: 'linear-gradient(135deg, #330022 0%, #660044 50%, #330022 100%)' },
    { id: 'neon', name: 'Neon', price: 1200, gradient: 'linear-gradient(135deg, #000033 0%, #330066 50%, #000033 100%)' },
    { id: 'sunset', name: 'Z√°pad slunce', price: 1500, gradient: 'linear-gradient(135deg, #331100 0%, #663300 50%, #331100 100%)' },
    { id: 'ice', name: 'Led', price: 1000, gradient: 'linear-gradient(135deg, #002233 0%, #004466 50%, #002233 100%)' },
    { id: 'galaxy', name: 'Galaxie', price: 2000, gradient: 'linear-gradient(135deg, #110033 0%, #220066 50%, #110033 100%)' },
    { id: 'rainbow', name: 'Duha', price: 3000, gradient: 'linear-gradient(135deg, #ff0080 0%, #8000ff 50%, #0080ff 100%)' }
];

let rotation = 0;
let spinning = false;
let autoRotating = true;

// Inicializace
window.addEventListener('load', () => {
    const savedUserId = localStorage.getItem('wheelUserId');
    if (savedUserId) {
        loadUser(savedUserId);
    }
});

function generateUserId() {
    return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

window.login = async function() {
    const nickname = document.getElementById('nicknameInput').value.trim();
    if (!nickname || nickname.length < 2) {
        alert('Zadejte p≈ôezd√≠vku (min. 2 znaky)');
        return;
    }
    
    currentUser.id = generateUserId();
    currentUser.nickname = nickname;
    currentUser.coins = 0;
    currentUser.ownedThemes = ['default'];
    currentUser.activeTheme = 'default';
    
    localStorage.setItem('wheelUserId', currentUser.id);
    
    if (database) {
        await set(ref(database, 'users/' + currentUser.id), currentUser);
    } else {
        localStorage.setItem('wheelUser_' + currentUser.id, JSON.stringify(currentUser));
    }
    
    document.getElementById('loginModal').style.display = 'none';
    updateUI();
    loadLeaderboard();
};

async function loadUser(userId) {
    currentUser.id = userId;
    
    if (database) {
        const userRef = ref(database, 'users/' + userId);
        const snapshot = await get(userRef);
        if (snapshot.exists()) {
            currentUser = snapshot.val();
        }
    } else {
        const saved = localStorage.getItem('wheelUser_' + userId);
        if (saved) {
            currentUser = JSON.parse(saved);
        }
    }
    
    document.getElementById('loginModal').style.display = 'none';
    updateUI();
    applyTheme(currentUser.activeTheme);
    loadLeaderboard();
}

async function saveUser() {
    if (database) {
        await update(ref(database, 'users/' + currentUser.id), {
            coins: currentUser.coins,
            ownedThemes: currentUser.ownedThemes,
            activeTheme: currentUser.activeTheme
        });
    } else {
        localStorage.setItem('wheelUser_' + currentUser.id, JSON.stringify(currentUser));
    }
    loadLeaderboard();
}

function updateUI() {
    document.getElementById('userName').textContent = currentUser.nickname;
    document.getElementById('coinAmount').textContent = currentUser.coins;
}

// Kreslen√≠ kola
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const slice = 2 * Math.PI / wheelPrizes.length;
    
    wheelPrizes.forEach((prize, i) => {
        ctx.beginPath();
        ctx.moveTo(center, center);
        ctx.arc(center, center, center - 5, rotation + i * slice, rotation + (i + 1) * slice);
        ctx.fillStyle = prize.color;
        ctx.fill();
        
        ctx.strokeStyle = 'rgba(0,0,0,0.3)';
        ctx.lineWidth = 3;
        ctx.stroke();
        
        ctx.save();
        ctx.translate(center, center);
        ctx.rotate(rotation + i * slice + slice / 2);
        ctx.fillStyle = "white";
        ctx.strokeStyle = "black";
        ctx.lineWidth = 3;
        ctx.textAlign = "right";
        ctx.font = "bold 24px Bangers";
        const text = prize.coins === 0 ? '0 ü™ô' : `${prize.coins} ü™ô`;
        ctx.strokeText(text, center - 30, 8);
        ctx.fillText(text, center - 30, 8);
        ctx.restore();
    });
}

function autoRotate() {
    if (autoRotating && !spinning) rotation += 0.001;
    draw();
    requestAnimationFrame(autoRotate);
}
autoRotate();

// Toƒçen√≠ kola
window.spin = async function() {
    if (spinning) return;
    
    spinning = true;
    autoRotating = false;
    document.getElementById('spinBtn').disabled = true;
    
    // V√Ωbƒõr v√Ωhry podle pravdƒõpodobnosti
    const random = Math.random() * 100;
    let cumulative = 0;
    let selectedPrize = null;
    
    for (let prize of wheelPrizes) {
        cumulative += prize.weight;
        if (random < cumulative) {
            selectedPrize = prize;
            break;
        }
    }
    
    if (!selectedPrize) selectedPrize = wheelPrizes[0];
    
    const prizeIndex = wheelPrizes.indexOf(selectedPrize);
    const slice = 2 * Math.PI / wheelPrizes.length;
    const targetRotation = 2 * Math.PI * 8 + (3 / 2 * Math.PI - prizeIndex * slice - slice / 2);
    
    const startRotation = rotation;
    const duration = 7000;
    let startTime = null;
    
    function anim(timestamp) {
        if (!startTime) startTime = timestamp;
        let elapsed = timestamp - startTime;
        let t = Math.min(elapsed / duration, 1);
        rotation = startRotation + (targetRotation - startRotation) * easeOutCubic(t);
        draw();
        if (t < 1) {
            requestAnimationFrame(anim);
        } else {
            setTimeout(() => finishSpin(selectedPrize.coins), 500);
        }
    }
    requestAnimationFrame(anim);
};

function easeOutCubic(t) {
    return 1 - Math.pow(1 - t, 3);
}

async function finishSpin(coinWin) {
    spinning = false;
    document.getElementById('spinBtn').disabled = false;
    autoRotating = true;
    
    currentUser.coins += coinWin;
    await saveUser();
    updateUI();
    
    document.getElementById('winAmount').textContent = `+${coinWin} ü™ô`;
    document.getElementById('winModal').style.display = 'flex';
    
    // Konfety
    if (coinWin > 0) {
        for (let i = 0; i < 100; i++) {
            setTimeout(() => createConfetti(), i * 15);
        }
    }
}

function createConfetti() {
    const c = document.createElement("div");
    c.className = "confetti";
    c.style.left = Math.random() * window.innerWidth + "px";
    c.style.top = "-10px";
    c.style.background = `hsl(${Math.random() * 360}, 80%, 60%)`;
    c.style.width = (5 + Math.random() * 10) + "px";
    c.style.height = c.style.width;
    document.body.appendChild(c);
    
    const speedY = 3 + Math.random() * 5;
    const driftX = (Math.random() - 0.5) * 4;
    let y = -10;
    
    function fall() {
        y += speedY;
        c.style.top = y + "px";
        c.style.left = parseFloat(c.style.left) + driftX + "px";
        if (y < window.innerHeight) requestAnimationFrame(fall);
        else c.remove();
    }
    fall();
}

window.closeWinModal = function() {
    document.getElementById('winModal').style.display = 'none';
};

// ≈Ωeb≈ô√≠ƒçek
async function loadLeaderboard() {
    const list = document.getElementById('leaderboardList');
    list.innerHTML = '';
    
    let users = [];
    if (database) {
        const usersRef = ref(database, 'users');
        const snapshot = await get(usersRef);
        if (snapshot.exists()) {
            Object.values(snapshot.val()).forEach(user => {
                users.push(user);
            });
        }
    } else {
        // Fallback na localStorage
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith('wheelUser_')) {
                users.push(JSON.parse(localStorage.getItem(key)));
            }
        }
    }
    
    users.sort((a, b) => b.coins - a.coins);
    users.slice(0, 10).forEach((user, index) => {
        const item = document.createElement('div');
        item.className = 'leaderboard-item';
        item.innerHTML = `
            <span class="leaderboard-rank">${index + 1}.</span>
            <span class="leaderboard-name">${user.nickname}</span>
            <span class="leaderboard-coins">${user.coins} ü™ô</span>
        `;
        list.appendChild(item);
    });
}

// Obchod
window.openShop = function() {
    const grid = document.getElementById('shopGrid');
    grid.innerHTML = '';
    
    themes.forEach(theme => {
        const owned = currentUser.ownedThemes.includes(theme.id);
        const active = currentUser.activeTheme === theme.id;
        
        const item = document.createElement('div');
        item.className = 'shop-item';
        if (owned) item.classList.add('owned');
        if (active) item.classList.add('active');
        
        item.innerHTML = `
            <div class="shop-preview" style="background: ${theme.gradient}"></div>
            <div class="shop-name">${theme.name}</div>
            <div class="shop-price">${theme.price === 0 ? 'ZDARMA' : theme.price + ' ü™ô'}</div>
            <button class="shop-buy-btn" 
                    onclick="buyTheme('${theme.id}')"
                    ${owned ? (active ? 'disabled' : '') : (currentUser.coins < theme.price ? 'disabled' : '')}>
                ${active ? 'AKTIVN√ç' : (owned ? 'POU≈Ω√çT' : 'KOUPIT')}
            </button>
        `;
        
        grid.appendChild(item);
    });
    
    document.getElementById('shopModal').style.display = 'flex';
};

window.buyTheme = async function(themeId) {
    const theme = themes.find(t => t.id === themeId);
    const owned = currentUser.ownedThemes.includes(themeId);
    
    if (!owned) {
        if (currentUser.coins < theme.price) {
            alert('Nem√°te dostatek minc√≠!');
            return;
        }
        currentUser.coins -= theme.price;
        currentUser.ownedThemes.push(themeId);
    }
    
    currentUser.activeTheme = themeId;
    await saveUser();
    updateUI();
    applyTheme(themeId);
    openShop(); // Refresh
};

function applyTheme(themeId) {
    document.body.className = 'theme-' + themeId;
}

window.closeShop = function() {
    document.getElementById('shopModal').style.display = 'none';
};

window.goBack = function() {
    window.location.href = 'hry.html';
};

// Enter pro login
document.getElementById('nicknameInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') login();
});
</script>

</body>
</html>