<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tetris</title>
<style>
    #tetrisAdminBtn:hover {
    background: linear-gradient(135deg, rgba(255,180,0,1) 0%, rgba(220,120,0,1) 100%);
    transform: translateY(-2px);
    box-shadow: 0 0 35px rgba(255,150,0,0.9);
}
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    margin: 0;
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
    font-family: "Segoe UI", sans-serif;
    color: white;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow-x: hidden;
}

.centered {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
}

h1 {
    margin-bottom: 30px;
    font-size: 56px;
    text-align: center;
    text-shadow: 0 0 20px #ff00ff, 0 0 40px #ff00ff;
    animation: glow 2s ease-in-out infinite;
}

@keyframes glow {
    0%, 100% { text-shadow: 0 0 20px #ff00ff, 0 0 40px #ff00ff; }
    50% { text-shadow: 0 0 30px #00ffff, 0 0 60px #00ffff; }
}

#backBtn {
    position: absolute;
    top: 20px;
    left: 20px;
    padding: 12px 24px;
    border-radius: 8px;
    border: 2px solid #ff00ff;
    background: rgba(180, 0, 180, 0.3);
    color: white;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 0 15px rgba(255, 0, 255, 0.5);
    z-index: 10;
    transition: all 0.3s;
}

#backBtn:hover {
    background: rgba(255, 0, 255, 0.5);
    box-shadow: 0 0 25px rgba(255, 0, 255, 0.8);
    transform: translateY(-2px);
}

#coinsDisplay {
    position: absolute;
    top: 20px;
    right: 20px;
    padding: 15px 30px;
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 165, 0, 0.3));
    border: 3px solid gold;
    border-radius: 12px;
    font-size: 28px;
    font-weight: bold;
    color: gold;
    text-shadow: 0 0 15px rgba(255, 215, 0, 0.9);
    box-shadow: 0 0 25px rgba(255, 215, 0, 0.5);
    z-index: 10;
    animation: coinPulse 2s ease-in-out infinite;
}

@keyframes coinPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}



button.menuBtn {
    padding: 16px 48px;
    margin: 12px 0;
    font-size: 22px;
    border: 2px solid #00ffff;
    border-radius: 12px;
    cursor: pointer;
    font-weight: bold;
    background: linear-gradient(135deg, rgba(0, 100, 200, 0.4), rgba(100, 0, 200, 0.4));
    color: white;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
    transition: all 0.3s;
    min-width: 280px;
    position: relative;
}

button.menuBtn:hover:not(.locked) {
    transform: scale(1.08) translateY(-3px);
    box-shadow: 0 0 35px rgba(0, 255, 255, 0.8);
    background: linear-gradient(135deg, rgba(0, 150, 255, 0.6), rgba(150, 0, 255, 0.6));
}

button.menuBtn:active:not(.locked) {
    transform: scale(1.03);
}

button.menuBtn.locked {
    background: linear-gradient(135deg, rgba(100, 100, 100, 0.3), rgba(50, 50, 50, 0.3));
    border-color: #666;
    color: #999;
    cursor: not-allowed;
}

button.menuBtn.locked::after {
    content: 'ğŸ”’';
    position: absolute;
    right: 15px;
    font-size: 24px;
}

.price-tag {
    position: absolute;
    right: 50px;
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 165, 0, 0.3));
    border: 2px solid gold;
    border-radius: 6px;
    padding: 4px 12px;
    font-size: 16px;
    color: gold;
    font-weight: bold;
}

#tetrisGame {
    display: none;
    position: relative;
    gap: 30px;
    flex-direction: row;
}

.game-container {
    display: flex;
    gap: 30px;
    align-items: flex-start;
}

.side-panel {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.info-box {
    background: rgba(30, 30, 60, 0.7);
    border: 2px solid #00ffff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
    min-width: 180px;
}

.info-box h3 {
    text-align: center;
    margin-bottom: 15px;
    color: #00ffff;
    text-shadow: 0 0 10px #00ffff;
}

#score, #level, #lines, #combo {
    font-size: 32px;
    font-weight: bold;
    text-align: center;
    color: #fff;
    text-shadow: 0 0 10px #ff00ff;
}

#nextPiece, #holdPiece {
    width: 120px;
    height: 120px;
    display: grid;
    grid-template-columns: repeat(4, 30px);
    grid-template-rows: repeat(4, 30px);
    gap: 1px;
    background: #111;
    margin: 0 auto;
}

.preview-cell {
    width: 28px;
    height: 28px;
    background: #222;
    border-radius: 3px;
}

#tetris {
    display: grid;
    gap: 1px;
    background: rgba(17, 17, 34, 0.9);
    border: 3px solid #00ffff;
    border-radius: 8px;
    box-shadow: 0 0 40px rgba(0, 255, 255, 0.5);
    padding: 3px;
}

.cell {
    width: 30px;
    height: 30px;
    background: #1a1a2e;
    border: 1px solid #111;
    border-radius: 3px;
    transition: all 0.1s;
}

.cell.filled {
    box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.3);
}

#leaderboard {
    display: none;
    flex-direction: column;
    align-items: center;
    max-width: 90%;
}

#leaderboard table {
    border-collapse: collapse;
    width: 600px;
    background: rgba(30, 30, 60, 0.7);
    border: 2px solid #00ffff;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.4);
    margin: 20px 0;
}

#leaderboard th {
    background: linear-gradient(135deg, #0064c8, #6400c8);
    padding: 15px;
    text-align: center;
    color: #00ffff;
    text-shadow: 0 0 10px #00ffff;
}

#leaderboard td {
    border-top: 1px solid rgba(0, 255, 255, 0.2);
    padding: 12px;
    text-align: center;
    color: #fff;
}

#leaderboard tr:hover {
    background: rgba(0, 255, 255, 0.1);
}

.loading {
    text-align: center;
    padding: 20px;
    font-size: 18px;
    color: #00ffff;
}

.particle {
    position: fixed;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    pointer-events: none;
    animation: particleFall 1s ease-out forwards;
    z-index: 1000;
}

@keyframes particleFall {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(200px) scale(0); opacity: 0; }
}

.coin-particle {
    position: fixed;
    font-size: 32px;
    pointer-events: none;
    animation: coinFloat 2s ease-out forwards;
    z-index: 1000;
}

@keyframes coinFloat {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-200px) scale(1.5); opacity: 0; }
}

.controls {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(30, 30, 60, 0.8);
    border: 2px solid #00ffff;
    border-radius: 8px;
    padding: 15px;
    font-size: 14px;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
}

.controls h4 {
    color: #00ffff;
    margin-bottom: 8px;
}

.controls div {
    margin: 4px 0;
}

#nameModal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    justify-content: center;
    align-items: center;
    z-index: 100;
}

.modal-content {
    background: linear-gradient(135deg, #1a1a2e, #2a2a4e);
    padding: 40px;
    border-radius: 16px;
    border: 2px solid #00ffff;
    box-shadow: 0 0 50px rgba(0, 255, 255, 0.5);
    text-align: center;
}

.modal-content h2 {
    margin-bottom: 20px;
    color: #00ffff;
    text-shadow: 0 0 15px #00ffff;
}

.modal-content .coin-reward {
    font-size: 48px;
    margin: 20px 0;
    color: gold;
    text-shadow: 0 0 20px gold;
}

.modal-content input {
    padding: 12px 20px;
    font-size: 18px;
    border: 2px solid #00ffff;
    border-radius: 8px;
    background: rgba(0, 0, 0, 0.5);
    color: white;
    width: 300px;
    margin-bottom: 20px;
}

.modal-content input:focus {
    outline: none;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.6);
}

.pause-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    justify-content: center;
    align-items: center;
    z-index: 50;
}

.pause-text {
    font-size: 72px;
    color: #00ffff;
    text-shadow: 0 0 30px #00ffff;
    animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

@media (max-width: 1024px) {
    .game-container {
        flex-direction: column;
        align-items: center;
    }
    
    .controls {
        position: static;
        margin-top: 20px;
    }
}
/* ScrollovatelnÃ© menu s grid layoutem */
.menu-section {
    max-height: 60vh;
    overflow-y: auto;
    padding: 20px;
    width: 100%;
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* 2 sloupce vedle sebe */
    gap: 15px;
    align-items: start;
}

.menu-section .menuBtn {
    margin: 0; /* OdstraÅˆ margin protoÅ¾e je nahrazen gap */
    width: 100%; /* TlaÄÃ­tka vyplnÃ­ celou Å¡Ã­Å™ku sloupce */
}

.menu-section::-webkit-scrollbar {
    width: 10px;
}

.menu-section::-webkit-scrollbar-track {
    background: rgba(0, 255, 255, 0.1);
    border-radius: 5px;
}

.menu-section::-webkit-scrollbar-thumb {
    background: rgba(0, 255, 255, 0.5);
    border-radius: 5px;
}

.menu-section::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 255, 255, 0.8);
}

/* Pro vÄ›tÅ¡Ã­ obrazovky - 3 sloupce */
@media (min-width: 1200px) {
    .menu-section {
        grid-template-columns: repeat(3, 1fr);
    }
}

/* Pro mobily - 1 sloupec */
@media (max-width: 768px) {
    .menu-section {
        grid-template-columns: 1fr;
    }
}
</style>
</head>
<body>

<button id="backBtn" onclick="window.location.href='hry.html'">â¬… ZpÄ›t</button>
<div id="coinsDisplay">ğŸ’° <span id="coinCount">0</span></div>

<div id="mainMenu" class="centered">
    <h1>ğŸ® TETRIS ğŸ®</h1>
    <button class="menuBtn" onclick="startTetris(selectedDifficulty)">ğŸš€ Singleplayer</button>
    <button class="menuBtn" onclick="showOnlineMultiplayer()">ğŸŒ Multiplayer</button>
    <button class="menuBtn" onclick="showLeaderboard()">ğŸ† Å½ebÅ™Ã­Äek</button>
    <button class="menuBtn" onclick="showDifficultyMenu()">âš™ï¸ NastavenÃ­</button>
    <button class="menuBtn" onclick="showMapMenu()">ğŸ“ Mapy</button>
    <button class="menuBtn" onclick="showThemeMenu()">ğŸ¨ Vzhled</button>
</div>

<div id="difficultyMenu" class="centered" style="display:none;">
    <h1>ObtÃ­Å¾nost</h1>
    <button class="menuBtn" onclick="setDifficulty('easy')">ğŸ˜Š SnadnÃ¡</button>
    <button class="menuBtn" onclick="setDifficulty('medium')">ğŸ˜ StÅ™ednÃ­</button>
    <button class="menuBtn" onclick="setDifficulty('hard')">ğŸ˜ˆ TÄ›Å¾kÃ¡</button>
    <button class="menuBtn" onclick="setDifficulty('insane')">ğŸ’€ Å Ã­lenÃ¡</button>
    <button class="menuBtn" onclick="backToMainMenu()">â¬… ZpÄ›t</button>
</div>

<div id="themeMenu" class="centered" style="display:none;">
    <h1>BarevnÃ© tÃ©ma</h1>
    <div class="menu-section">
        <button class="menuBtn" id="theme-classic" onclick="setTheme('classic')">ğŸŒˆ KlasickÃ©</button>
        <button class="menuBtn" id="theme-neon" onclick="setTheme('neon')">âœ¨ Neon</button>
        <button class="menuBtn locked" id="theme-fire" onclick="buyTheme('fire', 150)">
            ğŸ”¥ OheÅˆ
            <span class="price-tag">ğŸ’° 150</span>
        </button>
        <button class="menuBtn locked" id="theme-ice" onclick="buyTheme('ice', 180)">
            â„ï¸ Led
            <span class="price-tag">ğŸ’° 180</span>
        </button>
        <button class="menuBtn locked" id="theme-forest" onclick="buyTheme('forest', 220)">
            ğŸŒ² Les
            <span class="price-tag">ğŸ’° 220</span>
        </button>
        <button class="menuBtn locked" id="theme-sunset" onclick="buyTheme('sunset', 270)">
            ğŸŒ… ZÃ¡pad slunce
            <span class="price-tag">ğŸ’° 270</span>
        </button>
        <button class="menuBtn locked" id="theme-ocean" onclick="buyTheme('ocean', 310)">
            ğŸŒŠ OceÃ¡n
            <span class="price-tag">ğŸ’° 310</span>
        </button>
        <button class="menuBtn locked" id="theme-candy" onclick="buyTheme('candy', 350)">
            ğŸ¬ Candy
            <span class="price-tag">ğŸ’° 350</span>
        </button>
        <button class="menuBtn locked" id="theme-galaxy" onclick="buyTheme('galaxy', 400)">
            ğŸŒŒ Galaxie
            <span class="price-tag">ğŸ’° 400</span>
        </button>
        <button class="menuBtn locked" id="theme-toxic" onclick="buyTheme('toxic', 450)">
            â˜¢ï¸ Toxic
            <span class="price-tag">ğŸ’° 450</span>
        </button>
        <button class="menuBtn locked" id="theme-rainbow" onclick="buyTheme('rainbow', 500)">
            ğŸ¦„ Duha
            <span class="price-tag">ğŸ’° 500</span>
        </button>
        <button class="menuBtn locked" id="theme-gold" onclick="buyTheme('gold', 600)">
            ğŸ‘‘ ZlatÃ©
            <span class="price-tag">ğŸ’° 600</span>
        </button>
        <button class="menuBtn locked" id="theme-matrix" onclick="buyTheme('matrix', 650)">
            ğŸ’» Matrix
            <span class="price-tag">ğŸ’° 650</span>
        </button>
        <button class="menuBtn locked" id="theme-lava" onclick="buyTheme('lava', 700)">
            ğŸŒ‹ LÃ¡va
            <span class="price-tag">ğŸ’° 700</span>
        </button>
        <button class="menuBtn locked" id="theme-midnight" onclick="buyTheme('midnight', 750)">
            ğŸŒ™ PÅ¯lnoc
            <span class="price-tag">ğŸ’° 750</span>
        </button>
        <button class="menuBtn locked" id="theme-crystal" onclick="buyTheme('crystal', 850)">
            ğŸ’ Krystal
            <span class="price-tag">ğŸ’° 850</span>
        </button>
    </div>
    <button class="menuBtn" onclick="backToMainMenu()">â¬… ZpÄ›t</button>
</div>

<div id="mapMenu" class="centered" style="display:none;">
    <h1>RozmÄ›ry mapy</h1>
    <div class="menu-section">
        <button class="menuBtn" id="map-20x10" onclick="setMap(20,10)">ğŸ“ StandardnÃ­ 20x10</button>
        <button class="menuBtn" id="map-18x12" onclick="setMap(18,12)">â†”ï¸ Å irokÃ¡ 18x12</button>
        <button class="menuBtn locked" id="map-22x8" onclick="buyMap('22x8', 22, 8, 150)">
            â†•ï¸ ÃšzkÃ¡ 22x8
            <span class="price-tag">ğŸ’° 150</span>
        </button>
        <button class="menuBtn locked" id="map-16x16" onclick="buyMap('16x16', 16, 16, 180)">
            â¬œ ÄŒtverec 16x16
            <span class="price-tag">ğŸ’° 180</span>
        </button>
        <button class="menuBtn locked" id="map-24x12" onclick="buyMap('24x12', 24, 12, 220)">
            â¬†ï¸ VysokÃ¡ 24x12
            <span class="price-tag">ğŸ’° 220</span>
        </button>
        <button class="menuBtn locked" id="map-12x20" onclick="buyMap('12x20', 12, 20, 270)">
            ğŸ“± DlouhÃ¡ 12x20
            <span class="price-tag">ğŸ’° 270</span>
        </button>
        <button class="menuBtn locked" id="map-15x15" onclick="buyMap('15x15', 15, 15, 310)">
            ğŸŸ¦ Kompakt 15x15
            <span class="price-tag">ğŸ’° 310</span>
        </button>
        <button class="menuBtn locked" id="map-25x8" onclick="buyMap('25x8', 25, 8, 350)">
            ğŸ“ Extra ÃºzkÃ¡ 25x8
            <span class="price-tag">ğŸ’° 350</span>
        </button>
        <button class="menuBtn locked" id="map-14x18" onclick="buyMap('14x18', 14, 18, 400)">
            ğŸ”² VertikÃ¡lnÃ­ 14x18
            <span class="price-tag">ğŸ’° 400</span>
        </button>
        <button class="menuBtn locked" id="map-26x10" onclick="buyMap('26x10', 26, 10, 450)">
            ğŸ¢ Mrakodrap 26x10
            <span class="price-tag">ğŸ’° 450</span>
        </button>
        <button class="menuBtn locked" id="map-18x18" onclick="buyMap('18x18', 18, 18, 500)">
            â¬› VelkÃ½ Ätverec 18x18
            <span class="price-tag">ğŸ’° 500</span>
        </button>
        <button class="menuBtn locked" id="map-10x25" onclick="buyMap('10x25', 10, 25, 550)">
            ğŸ¯ Ultra Å¡irokÃ¡ 10x25
            <span class="price-tag">ğŸ’° 550</span>
        </button>
        <button class="menuBtn locked" id="map-28x9" onclick="buyMap('28x9', 28, 9, 600)">
            ğŸ—¼ VÄ›Å¾ 28x9
            <span class="price-tag">ğŸ’° 600</span>
        </button>
        <button class="menuBtn locked" id="map-20x20" onclick="buyMap('20x20', 20, 20, 700)">
            ğŸª ArÃ©na 20x20
            <span class="price-tag">ğŸ’° 700</span>
        </button>
        <button class="menuBtn locked" id="map-30x10" onclick="buyMap('30x10', 30, 10, 800)">
            ğŸ° EpickÃ¡ 30x10
            <span class="price-tag">ğŸ’° 800</span>
        </button>
        <button class="menuBtn locked" id="map-25x25" onclick="buyMap('25x25', 25, 25, 1000)">
            ğŸ‘‘ Mega arÃ©na 25x25
            <span class="price-tag">ğŸ’° 1000</span>
        </button>
    </div>
    <button class="menuBtn" onclick="backToMainMenu()">â¬… ZpÄ›t</button>
</div>
<div id="leaderboard" class="centered">
    <h1>ğŸ† Online Å¾ebÅ™Ã­Äek ğŸ†</h1>
    <div class="loading">NaÄÃ­tÃ¡nÃ­ Å¾ebÅ™Ã­Äku...</div>
    <table id="leaderboardTable" style="display:none;">
        <tr><th>Pozice</th><th>HrÃ¡Ä</th><th>SkÃ³re</th><th>ObtÃ­Å¾nost</th><th>Datum</th></tr>
    </table>
    <button class="menuBtn" onclick="backToMainMenu()" style="margin-top: 20px;">â¬… ZpÄ›t</button>
</div>

<div id="tetrisGame" class="centered">
    <div class="game-container">
        <div class="side-panel">
            <div class="info-box">
                <h3>DALÅ Ã</h3>
                <div id="nextPiece"></div>
            </div>
            <div class="info-box">
                <h3>HOLD (C)</h3>
                <div id="holdPiece"></div>
            </div>
        </div>
        
        <div>
            <div id="tetris"></div>
        </div>
        
        <div class="side-panel">
            <div class="info-box">
                <h3>SKÃ“RE</h3>
                <div id="score">0</div>
            </div>
            <div class="info-box">
                <h3>ÃšROVEÅ‡</h3>
                <div id="level">1</div>
            </div>
            <div class="info-box">
                <h3>Å˜ÃDKY</h3>
                <div id="lines">0</div>
            </div>
            <div class="info-box">
                <h3>COMBO</h3>
                <div id="combo">0</div>
            </div>
        </div>
    </div>
    
    <div class="controls">
        <h4>OVLÃDÃNÃ:</h4>
        <div>â¬…ï¸â¡ï¸ - Pohyb</div>
        <div>â¬†ï¸ - Rotace</div>
        <div>â¬‡ï¸ - RychlejÅ¡Ã­ pÃ¡d</div>
        <div>MEZERNÃK - OkamÅ¾itÃ© umÃ­stÄ›nÃ­</div>
        <div>C - Hold dÃ­lku</div>
        <div>P - Pauza</div>
        <div>ESC - Menu</div>
    </div>
</div>

<div class="pause-overlay" id="pauseOverlay">
    <div class="pause-text">PAUZA</div>
</div>

<div id="nameModal">
    <div class="modal-content">
        <h2>ğŸ‰ SkvÄ›lÃ¡ hra! ğŸ‰</h2>
        <p style="font-size: 24px; margin-bottom: 10px;">Tvoje skÃ³re: <span id="finalScore">0</span></p>
        <div class="coin-reward">
            ğŸ’° +<span id="earnedCoins">0</span> mincÃ­!
        </div>
        <p id="saveMessage" style="font-size: 18px; color: #00ff00; margin: 20px 0;">
            âœ… SkÃ³re automaticky uloÅ¾eno!
        </p>
        <button class="menuBtn" onclick="backToMainMenu()">ğŸ  ZpÄ›t do menu</button>
    </div>
</div>
<!-- Online Multiplayer Menu -->
<div id="onlineMultiplayerMenu" class="centered" style="display:none;">
    <h1>ğŸŒ Online Multiplayer</h1>
    <button class="menuBtn" onclick="createOnlineGame()">ğŸ® VytvoÅ™it hru</button>
    <button class="menuBtn" onclick="showJoinGame()">ğŸ”— PÅ™ipojit se ke hÅ™e</button>
    <button class="menuBtn" onclick="backToMainMenu()">â¬… ZpÄ›t</button>
</div>

<!-- Join Game Menu -->
<div id="joinGameMenu" class="centered" style="display:none;">
    <h1>ğŸ”— PÅ™ipojit se ke hÅ™e</h1>
    <input id="gameCodeInput" placeholder="Zadej kÃ³d hry (napÅ™. ABC123)" style="padding: 15px; font-size: 18px; margin: 20px 0; width: 300px; text-align: center; text-transform: uppercase; background: rgba(0,0,0,0.5); color: #fff; border: 2px solid #0ff; border-radius: 8px;">
    <button class="menuBtn" onclick="joinOnlineGame()">âœ… PÅ™ipojit se</button>
    <button class="menuBtn" onclick="backToOnlineMenu()">â¬… ZpÄ›t</button>
</div>

<!-- Waiting Room -->
<div id="waitingRoom" class="centered" style="display:none;">
    <h1>â³ ÄŒekÃ¡rna</h1>
    <div style="background: rgba(0,255,255,0.1); border: 2px solid #0ff; border-radius: 12px; padding: 30px; margin: 20px 0;">
        <h2 style="color: #
            let currentGameId = null;
let currentGameCode = null;
let myPlayerNumber = null;
let onlineGameActive = false;
let onlinePlayer1 = null;
let onlinePlayer2 = null;
let gameStateSubscription = null;
let onlineGameLoopId = null;

window.showOnlineMultiplayer = function() {
    if (!currentUser || currentUser.is_guest) {
        alert('Pro online hru se musÃ­Å¡ pÅ™ihlÃ¡sit!');
        return;
    }
    
    hideAllScreens();
    document.getElementById('onlineMultiplayerMenu').style.display = 'flex';
}

function hideAllScreens() {
    document.getElementById('mainMenu').style.display = 'none';
    document.getElementById('onlineMultiplayerMenu').style.display = 'none';
    document.getElementById('joinGameMenu').style.display = 'none';
    document.getElementById('waitingRoom').style.display = 'none';
    document.getElementById('onlineGame').style.display = 'none';
    document.getElementById('tetrisGame').style.display = 'none';
}

function backToOnlineMenu() {
    hideAllScreens();
    document.getElementById('onlineMultiplayerMenu').style.display = 'flex';
}

window.createOnlineGame = async function() {
    const gameCode = generateGameCode();
    
    try {
        const { data, error } = await supabase
            .from('tetris_multiplayer_games')
            .insert([{
                game_code: gameCode,
                player1_id: currentUser.id,
                player1_username: currentUser.username,
                status: 'waiting'
            }])
            .select()
            .single();
        
        if (error) throw error;
        
        currentGameId = data.id;
        currentGameCode = gameCode;
        myPlayerNumber = 1;
        
        hideAllScreens();
        document.getElementById('waitingRoom').style.display = 'flex';
        document.getElementById('displayGameCode').textContent = gameCode;
        
        waitForPlayer2();
        
    } catch (error) {
        console.error('Chyba pÅ™i vytvÃ¡Å™enÃ­ hry:', error);
        alert('Chyba pÅ™i vytvÃ¡Å™enÃ­ hry!');
    }
}

window.joinOnlineGame = async function() {
    const code = document.getElementById('gameCodeInput').value.trim().toUpperCase();
    
    if (!code) {
        alert('Zadej kÃ³d hry!');
        return;
    }
    
    try {
        const { data: game, error } = await supabase
            .from('tetris_multiplayer_games')
            .select('*')
            .eq('game_code', code)
            .eq('status', 'waiting')
            .single();
        
        if (error || !game) {
            alert('Hra s tÃ­mto kÃ³dem neexistuje nebo jiÅ¾ byla zahÃ¡jena!');
            return;
        }
        
        const { error: updateError } = await supabase
            .from('tetris_multiplayer_games')
            .update({
                player2_id: currentUser.id,
                player2_username: currentUser.username,
                status: 'playing'
            })
            .eq('id', game.id);
        
        if (updateError) throw updateError;
        
        currentGameId = game.id;
        currentGameCode = code;
        myPlayerNumber = 2;
        
        await startOnlineGame();
        
    } catch (error) {
        console.error('Chyba pÅ™i pÅ™ipojovÃ¡nÃ­:', error);
        alert('Chyba pÅ™i pÅ™ipojovÃ¡nÃ­ ke hÅ™e!');
    }
}

async function waitForPlayer2() {
    const channel = supabase
        .channel(`game_${currentGameId}`)
        .on('postgres_changes', {
            event: 'UPDATE',
            schema: 'public',
            table: 'tetris_multiplayer_games',
            filter: `id=eq.${currentGameId}`
        }, (payload) => {
            if (payload.new.status === 'playing') {
                channel.unsubscribe();
                startOnlineGame();
            }
        })
        .subscribe();
}

window.cancelWaiting = async function() {
    if (currentGameId) {
        await supabase
            .from('tetris_multiplayer_games')
            .delete()
            .eq('id', currentGameId);
    }
    
    currentGameId = null;
    currentGameCode = null;
    myPlayerNumber = null;
    
    backToOnlineMenu();
}

async function startOnlineGame() {
    hideAllScreens();
    document.getElementById('onlineGame').style.display = 'flex';
    document.getElementById('currentGameCode').textContent = currentGameCode;
    
    onlineGameActive = true;
    
    // NaÄti informace o hrÃ¡ÄÃ­ch
    const { data: game } = await supabase
        .from('tetris_multiplayer_games')
        .select('*')
        .eq('id', currentGameId)
        .single();
    
    document.getElementById('player1Name').textContent = `ğŸ® ${game.player1_username}`;
    document.getElementById('player2Name').textContent = `ğŸ® ${game.player2_username}`;
    
    // Inicializace obou hrÃ¡ÄÅ¯
    onlinePlayer1 = createOnlinePlayer('onlineTetris1', 'onlineScore1', 'onlineLevel1', 15, 10, '#00ffff', 1);
    onlinePlayer2 = createOnlinePlayer('onlineTetris2', 'onlineScore2', 'onlineLevel2', 15, 10, '#ff00ff', 2);
    
    // VytvoÅ™ poÄÃ¡teÄnÃ­ stav pro mÃ©ho hrÃ¡Äe
    const myPlayer = myPlayerNumber === 1 ? onlinePlayer1 : onlinePlayer2;
    await saveGameState(myPlayer);
    
    // Sleduj zmÄ›ny
    subscribeToGameState();
    
    // Start smyÄky
    onlineGameLoop();
}

function createOnlinePlayer(gridId, scoreId, levelId, rows, cols, borderColor, playerNum) {
    const player = {
        grid: [],
        current: null,
        nextPiece: null,
        score: 0,
        level: 1,
        lines: 0,
        gameOver: false,
        dropInterval: 600,
        lastDrop: Date.now(),
        gridElement: document.getElementById(gridId),
        scoreElement: document.getElementById(scoreId),
        levelElement: document.getElementById(levelId),
        rows: rows,
        cols: cols,
        borderColor: borderColor,
        playerNumber: playerNum
    };
    
    player.gridElement.innerHTML = '';
    player.gridElement.style.gridTemplateRows = `repeat(${rows}, 25px)`;
    player.gridElement.style.gridTemplateColumns = `repeat(${cols}, 25px)`;
    player.gridElement.style.borderColor = borderColor;
    
    for (let r = 0; r < rows; r++) {
        player.grid[r] = [];
        for (let c = 0; c < cols; c++) {
            const cell = document.createElement('div');
            cell.classList.add('cell');
            cell.style.width = '23px';
            cell.style.height = '23px';
            player.gridElement.appendChild(cell);
            player.grid[r][c] = 0;
        }
    }
    
    player.nextPiece = randomTetromino();
    newTetrominoOnline(player);
    
    return player;
}

function newTetrominoOnline(player) {
    player.current = player.nextPiece;
    player.current.x = Math.floor(player.cols / 2) - 1;
    player.current.y = 0;
    player.nextPiece = randomTetromino();
    
    if (collisionOnline(player)) {
        player.gameOver = true;
        endOnlineGame(player.playerNumber === 1 ? 2 : 1);
    }
}

function collisionOnline(player, offsetX = 0, offsetY = 0) {
    if (!player || !player.current || !player.current.shape) return true;
    
    for (let r = 0; r < player.current.shape.length; r++) {
        for (let c = 0; c < player.current.shape[r].length; c++) {
            if (player.current.shape[r][c]) {
                let newY = player.current.y + r + offsetY;
                let newX = player.current.x + c + offsetX;
                if (newY >= player.rows || newX < 0 || newX >= player.cols) return true;
                if (newY >= 0 && player.grid[newY][newX]) return true;
            }
        }
    }
    return false;
}

function moveDownOnline(player) {
    if (player.gameOver) return;
    
    player.current.y++;
    if (collisionOnline(player)) {
        player.current.y--;
        freezeOnline(player);
        newTetrominoOnline(player);
    }
}

function freezeOnline(player) {
    for (let r = 0; r < player.current.shape.length; r++) {
        for (let c = 0; c < player.current.shape[r].length; c++) {
            if (player.current.shape[r][c]) {
                player.grid[player.current.y + r][player.current.x + c] = player.current.color;
            }
        }
    }
    
    clearLinesOnline(player);
}

function clearLinesOnline(player) {
    let cleared = 0;
    for (let r = player.rows - 1; r >= 0; r--) {
        if (player.grid[r].every(cell => cell !== 0)) {
            player.grid.splice(r, 1);
            player.grid.unshift(Array(player.cols).fill(0));
            cleared++;
            r++;
        }
    }
    
    if (cleared > 0) {
        player.lines += cleared;
        player.score += cleared * 100 * player.level;
        player.level = Math.floor(player.lines / 10) + 1;
        player.dropInterval = Math.max(100, 600 - (player.level * 50));
        updateDisplayOnline(player);
    }
}

function drawOnline(player) {
    if (!player || !player.gridElement) return;
    
    const cells = player.gridElement.querySelectorAll('.cell');
    
    cells.forEach(cell => {
        cell.style.background = '#1a1a2e';
        cell.style.boxShadow = 'none';
    });
    
    for (let r = 0; r < player.rows; r++) {
        for (let c = 0; c < player.cols; c++) {
            if (player.grid[r][c]) {
                const cell = cells[r * player.cols + c];
                if (cell) {
                    cell.style.background = player.grid[r][c];
                    cell.style.boxShadow = `0 0 8px ${player.grid[r][c]}`;
                }
            }
        }
    }
    
    if (player.current && player.current.shape) {
        for (let r = 0; r < player.current.shape.length; r++) {
            for (let c = 0; c < player.current.shape[r].length; c++) {
                if (player.current.shape[r][c]) {
                    const index = (player.current.y + r) * player.cols + (player.current.x + c);
                    if (index >= 0 && index < cells.length) {
                        cells[index].style.background = player.current.color;
                        cells[index].style.boxShadow = `0 0 12px ${player.current.color}`;
                    }
                }
            }
        }
    }
}

function updateDisplayOnline(player) {
    player.scoreElement.textContent = player.score;
    player.levelElement.textContent = player.level;
}

function rotateOnline(player) {
    if (!player || !player.current || !player.current.shape) return;
    
    const shape = player.current.shape;
    const N = shape.length;
    const M = shape[0].length;
    const rotated = [];
    
    for (let y = 0; y < M; y++) {
        rotated[y] = [];
        for (let x = 0; x < N; x++) {
            rotated[y][x] = shape[N - 1 - x][y] || 0;
        }
    }
    
    const oldShape = player.current.shape;
    player.current.shape = rotated;
    
    if (collisionOnline(player)) {
        player.current.shape = oldShape;
    }
}

async function saveGameState(player) {
    try {
        await supabase
            .from('tetris_game_state')
            .upsert({
                game_id: currentGameId,
                player_number: player.playerNumber,
                grid: player.grid,
                current_piece: player.current,
                score: player.score,
                level: player.level,
                lines: player.lines,
                game_over: player.gameOver,
                updated_at: new Date().toISOString()
            }, {
                onConflict: 'game_id,player_number'
            });
    } catch (error) {
        console.error('Chyba pÅ™i uklÃ¡dÃ¡nÃ­ stavu:', error);
    }
}

function subscribeToGameState() {
    gameStateSubscription = supabase
        .channel(`game_state_${currentGameId}`)
        .on('postgres_changes', {
            event: '*',
            schema: 'public',
            table: 'tetris_game_state',
            filter: `game_id=eq.${currentGameId}`
        }, async (payload) => {
            if (payload.new.player_number !== myPlayerNumber) {
                const otherPlayer = payload.new.player_number === 1 ? onlinePlayer1 : onlinePlayer2;
                
                otherPlayer.grid = payload.new.grid;
                otherPlayer.current = payload.new.current_piece;
                otherPlayer.score = payload.new.score;
                otherPlayer.level = payload.new.level;
                otherPlayer.lines = payload.new.lines;
                otherPlayer.gameOver = payload.new.game_over;
                
                updateDisplayOnline(otherPlayer);
                drawOnline(otherPlayer);
                
                if (payload.new.game_over) {
                    document.getElementById(`player${payload.new.player_number}Status`).textContent = 'âŒ PROHRÃL';
                    document.getElementById(`player${payload.new.player_number}Status`).style.color = '#f00';
                }
            }
        })
        .subscribe();
}

function onlineGameLoop() {
    if (!onlineGameActive) return;
    
    const now = Date.now();
    const myPlayer = myPlayerNumber === 1 ? onlinePlayer1 : onlinePlayer2;
    const otherPlayer = myPlayerNumber === 1 ? onlinePlayer2 : onlinePlayer1;
    
    if (myPlayer && !myPlayer.gameOver && now - myPlayer.lastDrop > myPlayer.dropInterval) {
        moveDownOnline(myPlayer);
        drawOnline(myPlayer);
        myPlayer.lastDrop = now;
        saveGameState(myPlayer);
    }
    
    if (otherPlayer) {
        drawOnline(otherPlayer);
    }
    
    onlineGameLoopId = requestAnimationFrame(onlineGameLoop);
}

async function endOnlineGame(winnerNumber) {
    onlineGameActive = false;
    
    if (onlineGameLoopId) {
        cancelAnimationFrame(onlineGameLoopId);
        onlineGameLoopId = null;
    }
    
    const winner = winnerNumber === 1 ? 
        (await supabase.from('tetris_multiplayer_games').select('player1_username').eq('id', currentGameId).single()).data.player1_username :
        (await supabase.from('tetris_multiplayer_games').select('player2_username').eq('id', currentGameId).single()).data.player2_username;
    
    await supabase
        .from('tetris_multiplayer_games')
        .update({
            status: 'finished',
            winner: winner
        })
        .eq('id', currentGameId);
    
    setTimeout(() => {
        alert(`ğŸ‰ ${winner} VYHRÃL! ğŸ‰`);
        leaveOnlineGame();
    }, 500);
}

window.leaveOnlineGame = async function() {
    onlineGameActive = false;
    
    if (onlineGameLoopId) {
        cancelAnimationFrame(onlineGameLoopId);
        onlineGameLoopId = null;
    }
    
    if (gameStateSubscription) {
        await gameStateSubscription.unsubscribe();
        gameStateSubscription = null;
    }
    
    currentGameId = null;
    currentGameCode = null;
    myPlayerNumber = null;
    onlinePlayer1 = null;
    onlinePlayer2 = null;
    
    backToMainMenu();
}
