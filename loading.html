<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Načítání…</title>

<style>
:root{
  --text: rgba(255,255,255,.94);
  --muted: rgba(255,255,255,.72);
  --barBg: rgba(0,0,0,.42);
  --barEdge: rgba(255,255,255,.14);
  --barFillA: rgba(255,255,255,.35);
  --barFillB: rgba(255,255,255,.92);
}

html, body { height: 100%; margin: 0; }

body{
  background:#000;
  overflow:hidden;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}

/* STAGE */
.stage{
  position:fixed;
  inset:0;
  background:#000;
  overflow:hidden;
}

/* BACKGROUND */
.bg{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;

  /* aby byl vidět celý obrázek (žádný ořez) */
  object-fit: contain;
  object-position: center;

  opacity:0;
  transition: opacity 1.1s ease-in-out;
  filter: saturate(1.06) contrast(1.06) brightness(.98);
  will-change: transform, opacity;
}

.bg.show{ opacity:1; }

/* jemný zoom, ale ať nezmizí okraje (contain) */
.kenburns{ animation: kenburns 18s ease-in-out forwards; }
@keyframes kenburns{
  0%   { transform: scale(1) translate(0,0); }
  100% { transform: scale(1.05) translate(-1%, -1%); }
}

/* OVERLAYS */
.vignette{
  position:absolute;
  inset:0;
  background: radial-gradient(1200px 700px at 50% 45%,
    rgba(0,0,0,0) 35%,
    rgba(0,0,0,.45) 78%,
    rgba(0,0,0,.78) 100%);
}

.mist{
  position:absolute;
  inset:0;
  background: linear-gradient(to bottom, rgba(0,0,0,.08), rgba(0,0,0,.55));
}

/* film grain */
.grain{
  position:absolute;
  inset:-20%;
  opacity:.14;
  background-image: repeating-linear-gradient(
    0deg,
    rgba(255,255,255,.04),
    rgba(255,255,255,.04) 1px,
    rgba(0,0,0,.04) 2px,
    rgba(0,0,0,.04) 3px
  );
  animation: grain 1.8s steps(6) infinite;
  mix-blend-mode: overlay;
}
@keyframes grain{
  0% { transform: translate(-2%, -1%); }
  100% { transform: translate(2%, 1%); }
}

/* === UI panel === */
.ui{
  position:absolute;
  left:50%;
  bottom: 5.5vh;
  transform: translateX(-50%);
  width: min(720px, 92vw);
  text-align:center;
  color: var(--text);
  z-index:5;
}

/* lehce “glass” karta pro text + bar */
.panel{
  padding: 18px 18px 16px;
  border-radius: 18px;
  background: rgba(0,0,0,.28);
  border: 1px solid rgba(255,255,255,.10);
  backdrop-filter: blur(10px);
  box-shadow: 0 18px 45px rgba(0,0,0,.55);
}

.title{
  font-size: 30px;
  font-weight: 900;
  letter-spacing: .2px;
  margin-bottom: 6px;
  text-shadow: 0 2px 22px rgba(0,0,0,.75);
}

.sub{
  font-size: 16px;
  color: var(--muted);
  margin-bottom: 14px;
}

/* PROGRESS BAR (vylepšený) */
.bar{
  position: relative;
  height: 34px;
  border-radius: 18px;
  background: var(--barBg);
  border: 1px solid var(--barEdge);
  overflow: hidden;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.10),
    inset 0 -10px 20px rgba(0,0,0,.35),
    0 12px 30px rgba(0,0,0,.45);
}

/* “stripy” pozadí v baru */
.bar::before{
  content:"";
  position:absolute;
  inset:0;
  background:
    linear-gradient(90deg, rgba(255,255,255,.08), rgba(255,255,255,0)),
    repeating-linear-gradient(
      135deg,
      rgba(255,255,255,.06) 0px,
      rgba(255,255,255,.06) 10px,
      rgba(255,255,255,0) 10px,
      rgba(255,255,255,0) 22px
    );
  opacity: .55;
  transform: translateX(0);
  animation: stripes 1.2s linear infinite;
  pointer-events:none;
}
@keyframes stripes{
  0% { transform: translateX(0); }
  100% { transform: translateX(28px); }
}

/* fill */
.fill{
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--barFillA), var(--barFillB));
  transition: width .10s linear;
  position: relative;
  box-shadow: 0 0 22px rgba(255,255,255,.18);
}

/* lesk nahoře na fill */
.fill::after{
  content:"";
  position:absolute;
  inset:0;
  background: linear-gradient(to bottom,
    rgba(255,255,255,.35),
    rgba(255,255,255,.07) 45%,
    rgba(255,255,255,0) 70%);
  opacity: .85;
  pointer-events:none;
}

/* procenta přímo v baru */
.pctInBar{
  position:absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 14px;
  color: rgba(255,255,255,.82);
  text-shadow: 0 2px 12px rgba(0,0,0,.7);
  z-index: 3;
  user-select:none;
}

/* malý “loading dot pulse” vedle textu */
.dots::after{
  content:"";
  display:inline-block;
  width: 20px;
  text-align:left;
  animation: dots 1.1s steps(4,end) infinite;
}
@keyframes dots{
  0%{ content:""; }
  25%{ content:"."; }
  50%{ content:".."; }
  75%{ content:"..."; }
  100%{ content:""; }
}
</style>
</head>

<body>

<div class="stage">
  <img id="bgImg" class="bg show kenburns" src="anim1.jpg" alt="loading">

  <div class="mist"></div>
  <div class="vignette"></div>
  <div class="grain"></div>

  <div class="ui">
    <div class="panel">
      <div class="title" id="loadingText">Načítání<span class="dots"></span></div>
      <div class="sub">Připravuji gopnika</div>

      <div class="bar" aria-label="Loading">
        <div class="fill" id="fill"></div>
        <div class="pctInBar" id="pct">0%</div>
      </div>
    </div>
  </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const NEXT_PAGE = params.get("next") || "postava.html";
const frames = ["anim1.jpg","anim2.jpg","anim3.jpg"];

// přesně 15 sekund celkem
const TOTAL_TIME = 15000;

// rozdělíme 15s mezi počet framů
const FRAME_TIME = Math.floor(TOTAL_TIME / frames.length);

frames.forEach(src => { const i = new Image(); i.src = src; });

const img  = document.getElementById("bgImg");
const fill = document.getElementById("fill");
const pct  = document.getElementById("pct");
const text = document.getElementById("loadingText");

let index = 0;
let start = performance.now();

function restartKenBurns(){
  img.classList.remove("kenburns");
  void img.offsetWidth;
  img.classList.add("kenburns");
}

// střídání obrázků
setInterval(() => {
  img.classList.remove("show");
  setTimeout(() => {
    index = (index + 1) % frames.length;
    img.src = frames[index];
    restartKenBurns();
    img.classList.add("show");
  }, 520);
}, FRAME_TIME);

// progress
function update(){
  const elapsed = performance.now() - start;
  const p = Math.min(elapsed / TOTAL_TIME, 1);
  const percent = Math.floor(p * 100);

  fill.style.width = percent + "%";
  pct.textContent = percent + "%";

  if (percent < 33) text.innerHTML = 'Načítání<span class="dots"></span>';
  else if (percent < 66) text.innerHTML = 'Připravuji obsah<span class="dots"></span>';
  else text.innerHTML = 'Dokončuji přípravy<span class="dots"></span>';

  if (percent >= 100){
    setTimeout(() => location.href = NEXT_PAGE, 250);
    return;
  }
  requestAnimationFrame(update);
}
requestAnimationFrame(update);
</script>

</body>
</html>

